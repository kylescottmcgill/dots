# Maintained by Kyle Mcgill (turtil) [email@kylescottmcgill.com]
pkgname=dwm
pkgver=6.0
pkgrel=2
pkgdesc="A dynamic window manager for X"
url="https://github.com/kylescottmcgill/dwm.git"
arch=('i686' 'x86_64' 'armv7h')
arch=('i686' 'x86_64')
license=('MIT/X')
groups=('modified')
options=(zipman)
makedepends=('git')
depends=('libx11' 'libxinerama')
conflicts=('dwm-git')
install=dwm.install
md5sums=('')

_gitroot="git@github.com:kylescottmcgill/dwm.git"
_gitname="dwm"
_gitbranch="master"

#prepare() {
#    if [[ -f $SRCDEST/config.h ]]; then
#        cp $SRCDEST/config.h $srcdir/dwm/config.h
#    fi
#}

build() {
    cd "${srcdir}" # cd into src folder

    msg "Connecting to GIT server...."
    if [ -d ${_gitname} ] ; then # check if git directory exists
        cd ${_gitname} && git pull # cd into git directory and pull
        msg "The local files are updated."
    else
        git clone ${_gitroot} ${_gitname} -b ${_gitbranch} # else clone to another folder
    fi

    cd "${srcdir}"

    msg "GIT checkout done or server timeout"

    rm -rf "${_gitname}-build"

    git clone "${_gitname}" "${_gitname}-build"

    if [ -e ../config.h ]
    then
        msg "using custom config.h"
        cp -f ../config.h ${srcdir}/${_gitname}-build/
    else
        msg "using default config.h"
    fi
}

package() {
    cd "${srcdir}/${_gitname}-build"
    make PREFIX=/usr DESTDIR="${pkgdir}" install
    install -Dm644 "LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
    rm -rvf "pkg"
}

#vim: set ts=8 sw=4 tw=100 et :
